<script>

const NOTIFICACION_OK = 1
const NOTIFICACION_DANGER = 2
const NOTIFICACION_WARNING = 3

function crearTablaContactos(){

    let tabla = document.getElementById('tablaContactos')
    //comprobar si tabla ya existe para evitar que se vea una nueva tabla a continuaci칩n de la primera
    //siempre se creara una nueva tabla al pulsar el boton
    if (tabla) tabla.remove()

    google.script.run.withSuccessHandler(crearTablaContactosCorrectamente)
    .withFailureHandler(crearTablaContactosError)
    .obtenerContactos()
}

function crearTablaContactosCorrectamente(obj){

    tabla = document.createElement('table')
    tabla.id = 'tablaContactos'
    let tablaHeader = document.createElement('thead')
    let tablaBody = document.createElement('tbody')
    //Metodo for anidado
    //Header de la tabla
    let primeraFila = document.createElement('tr')
    for(let i = 0; i < obj[0].length; i++){
        let celda = document.createElement('td')
        celda.textContent = obj[0][i]
        primeraFila.appendChild(celda)
    }
    tablaHeader.appendChild(primeraFila)
    tabla.appendChild(tablaHeader)

    //Cuerpo de la tabla, no analiza la primera fila
    for(let i = 1; i < obj.length; i++){
        let fila = document.createElement('tr')
        for(let j = 0; j < obj[i].length; j++){
            let celda = document.createElement('td')
            celda.textContent = obj[i][j]
            fila.appendChild(celda)
        }                
        tablaBody.appendChild(fila)                
    }

    //Metodo forEach
    /* Array.from(obj).forEach((filaActual, i) => {
        let fila = document.createElement('tr')
        filaActual.forEach(celdaActual => {
            let celda = document.createElement('td')
            celda.textContent = celdaActual
            fila.appendChild(celda)
        })
        if(i == 0){
            tablaHeader.appendChild(fila)
            tabla.appendChild(tablaHeader)
        }
        else{
            tablaBody.appendChild(fila)
        }                
    }) */

    //Agregar clases a la cabecera de la tabla
    tablaHeader.classList.add('table-dark')
    //Agregar cuerpo a la tabla
    tabla.appendChild(tablaBody)
    //Agregar clases a la tabla
    tabla.classList.add('table', 'table-striped', 'border', 'border-4', 'border-dark','table-success')
    //Agregar tabla a la p치gina
    document.getElementById('divcontactos').appendChild(tabla)
    //Mostrar notificaci칩n satisfactoria
    crearNotificacion(NOTIFICACION_OK, 'Contactos obtenidos correctamente', 'Todo en orden')
}

function crearTablaContactosError() {
    //mostrar notificaci칩n de error
    crearNotificacion(NOTIFICACION_DANGER, 'No se han obtenido contactos', 'Ocurrio un problema')

}

function crearNotificacion(tipo, mensaje, titulo) {
    //obtener datos notificacion
    let mensajeNotificacion = document.getElementById('mensajeNotificacion')
    let tituloNotificacion = document.getElementById('tituloNotificacion')
    let elementoNotificacion = document.getElementById('notificacion')
    let iconoNotificacion = document.getElementById('iconoNotificacion')
    let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion)

    //editar notificacion
    mensajeNotificacion.textContent = mensaje
    tituloNotificacion.textContent = titulo

    switch(tipo){
        case NOTIFICACION_OK:
        iconoNotificacion.className = ''
        iconoNotificacion.classList.add('bi', 'bi-check2-square')    
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-oscuro')
        break

        case NOTIFICACION_DANGER:
        iconoNotificacion.className = ''
        iconoNotificacion.classList.add('bi', 'bi-bug')    
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-oscuro')
        break

        case NOTIFICACION_WARNING:
        iconoNotificacion.className = ''
        iconoNotificacion.classList.add('bi', 'bi-exclamation-square')    
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-oscuro')
        break
    }
    //mostrar notificacion
    notificacion.show();
}

</script>